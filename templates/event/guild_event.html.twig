{% extends 'base.html.twig' %}

{% block title %}√âv√©nements de la guilde{% endblock %}

{% block body %}
<h1>√âv√©nements de la guilde {{ character.guild.name }}</h1>

<ul>
    {% for event in events %}
    <p>----------------------------------------------</p>
        <li style="margin-bottom: 15px;">
            <strong>{{ event.title }}</strong> ‚Äî {{ event.date|date('d/m/Y H:i') }}<br>
            {{ event.description }}<br>

            {% if character.role in ['GM', 'RL', 'Officier'] %}
                <a href="{{ path('app_event_edit', { id: event.id }) }}">‚úèÔ∏è Modifier</a>
            {% endif %}

            {% set participation = event.getParticipationFor(character) %}
            {% if participation %}
                <p>Statut : {{ participation.status }}</p>
            {% else %}
                <form method="post" action="{{ path('api_event_participation', { id: event.id }) }}" style="margin-top: 5px;">
                    <button name="status" value="accepted">‚úÖ Participer</button>
                    <button name="status" value="declined">‚ùå Refuser</button>
                </form>
            {% endif %}

            <button type="button" onclick="toggleResponses({{ event.id }})">üë• Voir les r√©ponses</button>

            <div id="responses-{{ event.id }}" style="display: none; margin-top: 5px; padding-left: 15px;">
                <strong>‚úÖ Accept√©s :</strong>
                <ul>
                    {% set hasAccepted = false %}
                    {% for p in event.participations %}
                        {% if p.status == 'accepted' %}
                            {% set hasAccepted = true %}
                            <li>{{ p.character.nameCharacter }}</li>
                        {% endif %}
                    {% endfor %}
                    {% if not hasAccepted %}
                        <li><em>Aucun participant pour l‚Äôinstant.</em></li>
                    {% endif %}
                </ul>

                <strong>‚ùå Refus√©s :</strong>
                <ul>
                    {% set hasDeclined = false %}
                    {% for p in event.participations %}
                        {% if p.status == 'declined' %}
                            {% set hasDeclined = true %}
                            <li>{{ p.character.nameCharacter }}</li>
                        {% endif %}
                    {% endfor %}
                    {% if not hasDeclined %}
                        <li><em>Aucun refus enregistr√©.</em></li>
                    {% endif %}
                </ul>
            </div>
        </li>
    {% else %}
        <li>Aucun √©v√©nement √† venir.</li>
    {% endfor %}
</ul>

{% if character.role in ['GM', 'RL', 'Officier'] %}
    <p><a href="{{ path('app_event_new') }}">‚ûï Cr√©er un nouvel √©v√©nement</a></p>
{% endif %}
<p><a href="{{ path('app_dashboard') }}">Retour au dashboard</a></p>

<script>
    function toggleResponses(eventId) {
        const el = document.getElementById('responses-' + eventId);
        el.style.display = el.style.display === 'none' ? 'block' : 'none';
    }
</script>
{% endblock %}
